Пишем скрипт
написать скрипт для крона
который раз в час присылает на заданную почту
- X IP адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта
- Y запрашиваемых адресов (с наибольшим кол-вом запросов) с указанием кол-ва запросов c момента последнего запуска скрипта
- все ошибки c момента последнего запуска
- список всех кодов возврата с указанием их кол-ва с момента последнего запуска
в письме должно быть прописан обрабатываемый временной диапазон
должна быть реализована защита от мультизапуска

##########################################
Для работы потребуется пакет mailutils
Выполняем установку: 
Debian|Ubuntu 
$ sudo apt-get install mailutils
Centos
$ sudo yum install mailutils

В репозитории идут 3 файлы:
- scrips.sh - файл сбора данных из access.log
- mail.sh - файл отправки электронного письма с вложением файла результатов сбора данных из access.log
- access.log - файл для проверки с данными работы web-сервиса NGINX

Дополнительно, в ходе работы скрипта создаются файлы:
- row_counter_log - хранит значение обработанных строк
- queryIP.log - предитог IP адреса кто запрашивает - удаляется
- requestIP.log - предитог адреса что запрашивают - удаляется
- allresponces.log - все сообщения - удаляется
- errorresponces.log - все ошибки HTTP - удаляется
- formail.log - итоговый файл, отправляемый по почте. Перезаписывается каждый раз при отработке скрипта script.sh

Шаги исполнения
1. Создаем директорию /opt/script
sudo mkdiк -p /opt/script
2. Копируем файлы mail.sh, scrips.sh и access.log в директорию /opt/script
cp mail.sh scrips.sh access.log /opt/script
3. Помечаем файлы mail.sh scrips.sh как исполяемые
$ sudo chmod +x scrips.sh mail.sh
4. Редактируем mail.sh, указывая в качестве в качестве значения параметра mail - свой электронный почтовый адрес, например, mymail@yandex.ru
Примечание. Почта может быть отсеяна спам-фильтром.
5. Редактируем файл scrips.sh, указывая адрес анализируемого файла access (можно использовать путь к примеру) и количество строк вывода для "Кто запрашивает" и  "Что запрашивают".

Редактируем расписание cron
$ crontab -e
Поскольку нужно реализовать защиту от мультизапуска, используем для этого штатный пакет flock
http://unix.com/man-page/linux/1/flock/

Используя flock, мы указываем, что при запуске скприта /opt/script/script.sh мы делаем блокировку от повторного запуска /var/tmp/script.sh.lock в течение 5 минут -w 300
Итоговое расписание cron будет включаеть 
Время запуска 
*/5 * * * * раз в 5 минут
параметры блокировки flock и наш скрипт
/var/tmp/script.sh.lock /opt/script/script.sh 
И перенаправление stderr в stdout (который пойдет в /dev/null)
Итоговая строка для crontab
*/5 * * * *  /usr/bin/flock -w 300 /var/tmp/script.sh.lock /opt/script/script.sh 2>&1

Сохраняем расписание и рестартуем службу cron
$ sudo service cron restart

Что по итогу:
Через ожидаемое время сработает скрипт, который соберет данные с указанного файла access.log, результат будет выгружен в файл formail.log, который будет отправлен на адрес электронной почты, указанный в mail.sh



